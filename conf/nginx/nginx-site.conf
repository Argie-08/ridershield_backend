server {
  # Render provisions and terminates SSL
  listen 80;

  # Make site accessible from http://localhost/
  server_name _;

  root /var/www/html/public;
  index index.html index.htm index.php;

  # Handle React routes by serving index.html for any non-file paths
  location / {
    try_files $uri $uri/ /index.html;
  }

  # Set max client body size and buffer size to handle larger requests
  client_max_body_size 10M;         # Adjust based on your requirements
  client_body_buffer_size 10M;       # Set the buffer size for the request body

  # Disable sendfile as per https://docs.vagrantup.com/v2/synced-folders/virtualbox.html
  sendfile off;

  # Add stdout logging
  error_log /dev/stdout info;
  access_log /dev/stdout;

  # block access to sensitive information about git
  location /.git {
    deny all;
    return 403;
  }

  add_header X-Frame-Options "SAMEORIGIN";
  add_header X-XSS-Protection "1; mode=block";
  add_header X-Content-Type-Options "nosniff";

  charset utf-8;

  # Fallback to Laravel if file not found, to handle API or PHP requests
  location ~ \.php$ {
    try_files $uri /index.php?$query_string;
    fastcgi_split_path_info ^(.+\.php)(/.+)$;
    fastcgi_pass unix:/var/run/php-fpm.sock;
    fastcgi_index index.php;
    fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
    fastcgi_param SCRIPT_NAME $fastcgi_script_name;
    include fastcgi_params;
  }

  location = /favicon.ico { access_log off; log_not_found off; }
  location = /robots.txt  { access_log off; log_not_found off; }

  # Set a custom error page for 404 errors
  error_page 404 /index.php;

  # Cache static assets
  location ~* \.(jpg|jpeg|gif|png|css|js|ico|webp|tiff|ttf|svg)$ {
    expires 5d;
  }

  # Deny access to hidden files or sensitive directories
  location ~ /\. {
    log_not_found off;
    deny all;
  }

  location ~ /\.(?!well-known).* {
    deny all;
  }
}


# server {
#   # Render provisions and terminates SSL
#   listen 80;

#   # Make site accessible from http://localhost/
#   server_name _;

#   root /var/www/html/public;
#   index index.html index.htm index.php;

#   location / {
#     try_files $uri /index.html;
#   }


#   # Set max client body size and buffer size to handle larger requests
#   client_max_body_size 10M;         # Adjust based on your requirements
#   client_body_buffer_size 10M;       # Set the buffer size for the request body


#   # Disable sendfile as per https://docs.vagrantup.com/v2/synced-folders/virtualbox.html
#   sendfile off;

#   # Add stdout logging
#   error_log /dev/stdout info;
#   access_log /dev/stdout;

#   # block access to sensitive information about git
#   location /.git {
#     deny all;
#     return 403;
#   }

#   add_header X-Frame-Options "SAMEORIGIN";
#   add_header X-XSS-Protection "1; mode=block";
#   add_header X-Content-Type-Options "nosniff";

#   charset utf-8;

#   location / {
#     try_files $uri $uri/ /index.php?$query_string;
#   }


#   location = /favicon.ico { access_log off; log_not_found off; }
#   location = /robots.txt  { access_log off; log_not_found off; }

#   error_page 404 /index.php;

#   location ~* \.(jpg|jpeg|gif|png|css|js|ico|webp|tiff|ttf|svg)$ {
#     expires 5d;
#   }

#   location ~ \.php$ {
#     fastcgi_split_path_info ^(.+\.php)(/.+)$;
#     fastcgi_pass unix:/var/run/php-fpm.sock;
#     fastcgi_index index.php;
#     fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
#     fastcgi_param SCRIPT_NAME $fastcgi_script_name;
#     include fastcgi_params;
#   }

#   # deny access to . files
#   location ~ /\. {
#     log_not_found off;
#     deny all;
#   }

#   location ~ /\.(?!well-known).* {
#     deny all;
#   }
  
# }

# server {
#     listen 80;
#     server_name _;

#     root /var/www/html/public;
#     index index.html index.htm index.php;

#     client_max_body_size 20M;
#     client_body_buffer_size 20M;

#     location / {
#         try_files $uri $uri/ /index.html;
#     }

#     location = /favicon.ico { access_log off; log_not_found off; }
#     location = /robots.txt { access_log off; log_not_found off; }

#     error_page 404 /index.html;

#     location ~* \.(jpg|jpeg|gif|png|css|js|ico|webp|tiff|ttf|svg)$ {
#         expires 5d;
#     }

#     location ~ \.php$ {
#         fastcgi_split_path_info ^(.+\.php)(/.+)$;
#         fastcgi_pass unix:/var/run/php-fpm.sock;
#         fastcgi_index index.php;
#         fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
#         fastcgi_param SCRIPT_NAME $fastcgi_script_name;
#         include fastcgi_params;
#     }

#     location ~ /\. {
#         log_not_found off;
#         deny all;
#     }

#     location ~ /\.(?!well-known).* {
#         deny all;
#     }
# }
